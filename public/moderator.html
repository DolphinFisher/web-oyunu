<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModeratÃ¶r Paneli</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- Lobiyi Kapat Butonu -->
        <button id="closeLobbyBtn" class="top-right-btn hidden" onclick="closeLobby()">Lobiyi Kapat</button>

        <!-- GiriÅŸ EkranÄ± -->
        <div id="loginScreen" class="card">
            <h2>ModeratÃ¶r GiriÅŸi</h2>
            <input type="text" id="username" placeholder="KullanÄ±cÄ± AdÄ±">
            <input type="password" id="password" placeholder="Åifre">
            <button onclick="login()">GiriÅŸ Yap</button>
        </div>

        <!-- Soru HazÄ±rlama EkranÄ± -->
        <div id="setupScreen" class="card hidden">
            <h2>Lobi Kurulumu</h2>
            
            <!-- Oyun Modu SeÃ§imi -->
            <div style="margin-bottom: 20px; text-align: left; background: var(--item-bg); padding: 15px; border-radius: 8px;">
                <h3>Oyun Modu SeÃ§imi:</h3>
                <div style="margin-top: 10px;">
                    <label style="display: block; margin-bottom: 8px; cursor: pointer;">
                        <input type="radio" name="gameMode" value="random" onchange="toggleGameMode('random')"> 
                        <strong>Random (Rastgele) Mod</strong>
                        <br><small style="margin-left: 20px; color: #ccc;">Ayarlar sistem tarafÄ±ndan belirlenir.</small>
                    </label>
                    <label style="display: block; cursor: pointer;">
                        <input type="radio" name="gameMode" value="manual" checked onchange="toggleGameMode('manual')"> 
                        <strong>Manuel Mod</strong>
                        <br><small style="margin-left: 20px; color: #ccc;">AyarlarÄ± kendiniz yapÄ±landÄ±rÄ±n.</small>
                    </label>
                </div>
            </div>

            <!-- Anonimlik Modu SeÃ§imi -->
            <div style="margin-bottom: 20px; text-align: left; background: var(--item-bg); padding: 15px; border-radius: 8px;">
                <h3>Oyuncu Gizlilik AyarlarÄ±:</h3>
                <p style="font-size: 0.9em; color: #ccc; margin-bottom: 15px;">
                    Ã‡ark Ã§evrilirken oyuncu isimlerinin gizlenip gizlenmeyeceÄŸini belirleyin.
                </p>
                <div style="margin-top: 10px;">
                    <label style="display: block; margin-bottom: 12px; cursor: pointer;">
                        <input type="radio" name="anonymity" value="none" checked> 
                        <strong>AÃ§Ä±k (Her Zaman GÃ¶rÃ¼nÃ¼r)</strong>
                        <br><small style="margin-left: 20px; color: #bbb;">Oyuncu isimleri Ã§ark dÃ¶nerken de aÃ§Ä±kÃ§a gÃ¶rÃ¼nÃ¼r.</small>
                    </label>
                    <label style="display: block; cursor: pointer;">
                        <input type="radio" name="anonymity" value="full"> 
                        <strong>Gizli (Ã‡arkta Anonim)</strong>
                        <br><small style="margin-left: 20px; color: #bbb;">Ä°simler lobide gÃ¶rÃ¼nÃ¼r, ancak Ã§ark Ã§ekiliÅŸinde "Anonim" olarak gizlenir.</small>
                    </label>
                </div>
            </div>

            <div id="manualSetupArea">
                <h3>Soru Ekleme</h3>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="newQuestion" placeholder="Sorunuzu buraya yazÄ±n...">
                    <button onclick="addQuestion()">Ekle</button>
                </div>
                <ul id="questionList"></ul>
                
                <div style="margin: 20px 0; text-align: left; background: var(--item-bg); padding: 15px; border-radius: 8px;">
                    <h3>KatÄ±lÄ±mcÄ± SorularÄ±nÄ±n (CevaplarÄ±nÄ±n) GÃ¶rÃ¼nÃ¼rlÃ¼k AyarÄ±:</h3>
                    <div style="margin-top: 10px;">
                        <label style="display: block; margin-bottom: 8px; cursor: pointer;">
                            <input type="radio" name="visibility" value="admin_only"> Sadece admin ekranÄ±nda gÃ¶ster
                        </label>
                        <label style="display: block; cursor: pointer;">
                            <input type="radio" name="visibility" value="public" checked> TÃ¼m katÄ±lÄ±mcÄ±lara gÃ¶ster
                        </label>
                    </div>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <button onclick="createLobby()" class="primary">Lobiyi OluÅŸtur & QR Ãœret</button>
            </div>
        </div>

        <!-- Lobi Bekleme EkranÄ± -->
        <div id="lobbyScreen" class="card hidden">
            <h2>
                Lobi HazÄ±r 
                <span id="lobbyModeBadge" style="font-size: 0.6em; background: var(--accent-color); padding: 2px 8px; border-radius: 10px; vertical-align: middle;">MANUEL</span>
            </h2>
            
            <div class="lobby-id-display" style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                <div style="font-size: 0.9em; opacity: 0.7; margin-bottom: 5px;">LOBI ID</div>
                <div id="lobbyIdDisplay" style="font-size: 2em; letter-spacing: 5px; font-weight: bold; color: var(--accent-color); font-family: monospace;">---</div>
            </div>

            <div id="anonymityBadge" style="font-size: 0.8em; margin-top: 5px; color: #aaa;">Gizlilik: AÃ§Ä±k</div>
            
            <p>Oyuncular QR kodu okutarak katÄ±labilir.</p>
            <div id="qrCodeContainer" style="margin: 20px;">
                <!-- QR Kod buraya gelecek -->
            </div>
            <h3>KatÄ±lÄ±mcÄ±lar (<span id="playerCount">0</span>)</h3>
            <ul id="playerList"></ul>
            <button onclick="startGame()">Oyunu BaÅŸlat</button>
        </div>

        <!-- Oyun YÃ¶netim EkranÄ± -->
        <div id="gameScreen" class="card hidden">
            <h2 id="currentQuestionDisplay">Soru YÃ¼kleniyor...</h2>
            
            <!-- Oyun Ä°Ã§i GÃ¶rÃ¼nÃ¼rlÃ¼k AyarÄ± -->
            <div style="background: var(--answer-bg); padding: 10px; border-radius: 5px; margin-bottom: 10px; font-size: 0.9em; display: flex; flex-direction: column; gap: 5px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span><strong>Cevap GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼:</strong> <span id="currentVisibilityDisplay">Herkese AÃ§Ä±k</span></span>
                    <button onclick="toggleVisibility()" style="padding: 5px 10px; font-size: 12px; background: #666;">DeÄŸiÅŸtir</button>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                     <span><strong>Gizlilik Modu:</strong> <span id="currentAnonymityDisplay">AÃ§Ä±k</span></span>
                     <button onclick="cycleAnonymity()" style="padding: 5px 10px; font-size: 12px; background: #666;">DeÄŸiÅŸtir</button>
                </div>
            </div>

            <div id="gameControls">
                <div style="margin: 20px 0;">
                    <p>Cevaplayanlar: <span id="answerStats">0 / 0</span></p>
                </div>
                
                <button id="revealBtn" onclick="revealAnswers()">CevaplarÄ± GÃ¶ster</button>
                <button id="spinBtn" class="hidden" onclick="spinWheel()">Ã‡arkÄ± Ã‡evir (%30 Åans)</button>
                <!-- Manuel Ã‡ark Butonu -->
                <button id="manualSpinBtn" onclick="spinWheel()" style="background-color: #9b59b6;">ğŸ² Manuel Ã‡ark BaÅŸlat</button>
                
                <button id="nextBtn" class="hidden" onclick="nextQuestion()">SÄ±radaki Soru</button>
            </div>

            <div id="answersContainer" style="margin-top: 20px;">
                <ul id="answerList"></ul>
            </div>
        </div>
        
        <!-- Ã‡ark Overlay -->
        <div id="wheelContainer" class="hidden">
            <div class="wheel-content">
                <h2>ÅanslÄ± KiÅŸi SeÃ§iliyor...</h2>
                <div id="wheelWinnerName" class="spinning-text">???</div>
                
                <!-- Toggle Button for Winner Name -->
                <div id="winnerControls" class="hidden" style="margin: 15px 0;">
                    <button id="toggleWinnerBtn" class="secondary" onclick="toggleWinnerName()">
                        ğŸ‘ï¸ Ä°smi GÃ¶ster
                    </button>
                </div>

                <p id="wheelInstruction" class="hidden">Kazanan bir cevap seÃ§ecek!</p>
                <button id="closeWheelBtn" class="hidden" onclick="closeWheel()">Devam Et</button>
            </div>
        </div>

        <!-- Custom Alert Modal -->
        <div id="customAlert" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="alertTitle">Mesaj</h3>
                    <button class="menu-dots" onclick="toggleAlertMenu()">â‹®</button>
                    <!-- MenÃ¼ (Dropdown) -->
                    <div id="alertMenu" class="dropdown-menu hidden">
                        <button onclick="copyAlertMessage()">Kopyala</button>
                        <button onclick="closeAlert()">Kapat</button>
                    </div>
                </div>
                <div class="modal-body">
                    <p id="alertMessage">Ä°Ã§erik</p>
                </div>
                <div class="modal-footer">
                    <button onclick="closeAlert()" class="primary">Tamam</button>
                </div>
            </div>
        </div>

        <!-- Custom Confirm Modal -->
        <div id="customConfirm" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="confirmTitle">Onay</h3>
                </div>
                <div class="modal-body">
                    <p id="confirmMessage">Emin misiniz?</p>
                </div>
                <div class="modal-footer">
                    <button id="confirmCancelBtn" class="danger" style="margin-right: 10px;">Ä°ptal</button>
                    <button id="confirmOkBtn" class="primary">Tamam</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Socket.IO Client KÃ¼tÃ¼phanesi -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <!-- Fallback REMOVED because it causes error on Netlify -->
    
    <script src="js/moderator.js"></script>
</body>
</html>
